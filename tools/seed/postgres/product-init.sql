-- Product Service Database Schema + Seed Data

-- Categories
CREATE TABLE IF NOT EXISTS categories (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(100) NOT NULL,
    parent_id UUID REFERENCES categories(id),
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Products
CREATE TABLE IF NOT EXISTS products (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) NOT NULL,
    description TEXT,
    brand VARCHAR(100),
    category_id UUID REFERENCES categories(id),
    base_price INTEGER NOT NULL, -- in KRW
    currency VARCHAR(3) DEFAULT 'KRW',
    image_url VARCHAR(500),
    status VARCHAR(20) DEFAULT 'ACTIVE',
    shipping_days INTEGER DEFAULT 3,
    compatibility_tags TEXT[], -- for cross-product compatibility checks
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Product Variants (size, color, etc.)
CREATE TABLE IF NOT EXISTS product_variants (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    product_id UUID NOT NULL REFERENCES products(id),
    sku VARCHAR(50) UNIQUE NOT NULL,
    name VARCHAR(100) NOT NULL, -- e.g., "Black / XL"
    size VARCHAR(20),
    color VARCHAR(50),
    price_adjustment INTEGER DEFAULT 0, -- additional price in KRW
    attributes JSONB DEFAULT '{}',
    status VARCHAR(20) DEFAULT 'ACTIVE',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_products_category ON products(category_id);
CREATE INDEX idx_products_brand ON products(brand);
CREATE INDEX idx_products_status ON products(status);
CREATE INDEX idx_products_name_search ON products USING gin(to_tsvector('simple', name || ' ' || COALESCE(description, '')));
CREATE INDEX idx_variants_product ON product_variants(product_id);

-- ============================================================
-- Seed Data: Fashion & Electronics Store
-- ============================================================

-- Categories
INSERT INTO categories (id, name, description) VALUES
    ('a1000000-0000-0000-0000-000000000001', '의류', '패션 의류'),
    ('a1000000-0000-0000-0000-000000000002', '전자기기', '전자제품 및 기기'),
    ('a1000000-0000-0000-0000-000000000003', '신발', '신발류'),
    ('a1000000-0000-0000-0000-000000000004', '액세서리', '패션 액세서리');

INSERT INTO categories (id, name, parent_id, description) VALUES
    ('a1000000-0000-0000-0000-000000000011', '상의', 'a1000000-0000-0000-0000-000000000001', '티셔츠, 셔츠, 니트 등'),
    ('a1000000-0000-0000-0000-000000000012', '하의', 'a1000000-0000-0000-0000-000000000001', '바지, 스커트 등'),
    ('a1000000-0000-0000-0000-000000000013', '아우터', 'a1000000-0000-0000-0000-000000000001', '자켓, 코트 등'),
    ('a1000000-0000-0000-0000-000000000021', '스마트폰', 'a1000000-0000-0000-0000-000000000002', '스마트폰'),
    ('a1000000-0000-0000-0000-000000000022', '노트북', 'a1000000-0000-0000-0000-000000000002', '노트북 컴퓨터'),
    ('a1000000-0000-0000-0000-000000000023', '이어폰/헤드폰', 'a1000000-0000-0000-0000-000000000002', '오디오 기기');

-- Products
INSERT INTO products (id, name, description, brand, category_id, base_price, shipping_days, compatibility_tags) VALUES
    -- 상의
    ('b1000000-0000-0000-0000-000000000001', '오버핏 코튼 티셔츠', '부드러운 순면 소재의 오버핏 반팔 티셔츠. 데일리 아이템으로 추천.', '무신사 스탠다드', 'a1000000-0000-0000-0000-000000000011', 19900, 2, ARRAY['casual', 'daily']),
    ('b1000000-0000-0000-0000-000000000002', '슬림핏 옥스포드 셔츠', '비즈니스 캐주얼에 적합한 옥스포드 셔츠. 구김이 적은 소재.', '폴로', 'a1000000-0000-0000-0000-000000000011', 89000, 3, ARRAY['business', 'formal']),
    ('b1000000-0000-0000-0000-000000000003', '캐시미어 블렌드 니트', '캐시미어 30% 혼방 니트. 보풀이 적고 부드러운 촉감.', '유니클로', 'a1000000-0000-0000-0000-000000000011', 49900, 2, ARRAY['casual', 'warm']),
    -- 하의
    ('b1000000-0000-0000-0000-000000000004', '스트레이트 데님 팬츠', '클래식한 스트레이트 핏 데님. 중간 두께로 사계절 착용 가능.', '리바이스', 'a1000000-0000-0000-0000-000000000012', 79000, 3, ARRAY['casual', 'daily']),
    ('b1000000-0000-0000-0000-000000000005', '와이드 슬랙스', '편안한 와이드 핏 슬랙스. 구김 방지 가공.', '무신사 스탠다드', 'a1000000-0000-0000-0000-000000000012', 39900, 2, ARRAY['business', 'casual']),
    -- 아우터
    ('b1000000-0000-0000-0000-000000000006', '경량 패딩 자켓', '초경량 다운 패딩. 휴대가 편한 파우치 포함.', '노스페이스', 'a1000000-0000-0000-0000-000000000013', 159000, 3, ARRAY['outdoor', 'warm']),
    ('b1000000-0000-0000-0000-000000000007', '울 블렌드 코트', '울 70% 혼방 싱글 코트. 세미 오버핏.', '코스', 'a1000000-0000-0000-0000-000000000013', 289000, 5, ARRAY['formal', 'warm']),
    -- 스마트폰
    ('b1000000-0000-0000-0000-000000000008', '갤럭시 S24 Ultra', '최신 AI 기능 탑재. 6.8인치 다이나믹 AMOLED 디스플레이.', '삼성', 'a1000000-0000-0000-0000-000000000021', 1599000, 1, ARRAY['samsung', 'android', 'flagship']),
    ('b1000000-0000-0000-0000-000000000009', '아이폰 15 Pro', 'A17 Pro 칩 탑재. 티타늄 디자인.', '애플', 'a1000000-0000-0000-0000-000000000021', 1550000, 1, ARRAY['apple', 'ios', 'flagship']),
    -- 노트북
    ('b1000000-0000-0000-0000-000000000010', '맥북 에어 M3', 'M3 칩, 15인치 Liquid Retina 디스플레이. 18시간 배터리.', '애플', 'a1000000-0000-0000-0000-000000000022', 1890000, 2, ARRAY['apple', 'laptop', 'portable']),
    ('b1000000-0000-0000-0000-000000000011', '갤럭시북4 프로', '인텔 Ultra 프로세서, 16인치 AMOLED. 경량 설계.', '삼성', 'a1000000-0000-0000-0000-000000000022', 1790000, 2, ARRAY['samsung', 'laptop', 'portable']),
    -- 이어폰/헤드폰
    ('b1000000-0000-0000-0000-000000000012', '에어팟 프로 2', '적응형 노이즈 캔슬링, USB-C 충전. H2 칩.', '애플', 'a1000000-0000-0000-0000-000000000023', 359000, 1, ARRAY['apple', 'audio', 'wireless']),
    ('b1000000-0000-0000-0000-000000000013', '갤럭시 버즈3 프로', '360 오디오, 지능형 ANC. 방수 IPX7.', '삼성', 'a1000000-0000-0000-0000-000000000023', 299000, 1, ARRAY['samsung', 'audio', 'wireless']),
    ('b1000000-0000-0000-0000-000000000014', 'WH-1000XM5', '업계 최고의 노이즈 캔슬링 헤드폰. 30시간 배터리.', '소니', 'a1000000-0000-0000-0000-000000000023', 399000, 2, ARRAY['sony', 'audio', 'wireless', 'headphone']),
    -- 신발
    ('b1000000-0000-0000-0000-000000000015', '에어포스 1 07', '클래식 화이트 스니커즈. 에어 유닛 쿠셔닝.', '나이키', 'a1000000-0000-0000-0000-000000000003', 139000, 3, ARRAY['casual', 'sneaker']),
    ('b1000000-0000-0000-0000-000000000016', '뉴발란스 530', '레트로 러닝 스니커즈. ABZORB 쿠셔닝.', '뉴발란스', 'a1000000-0000-0000-0000-000000000003', 139000, 3, ARRAY['casual', 'sneaker', 'retro']),
    -- 액세서리
    ('b1000000-0000-0000-0000-000000000017', '클래식 가죽 벨트', '이탈리안 소가죽 벨트. 자동 버클.', '몽블랑', 'a1000000-0000-0000-0000-000000000004', 250000, 3, ARRAY['formal', 'leather']),
    ('b1000000-0000-0000-0000-000000000018', '캔버스 토트백', '대용량 캔버스 토트백. A4 수납 가능.', '무신사 스탠다드', 'a1000000-0000-0000-0000-000000000004', 29900, 2, ARRAY['casual', 'bag']);

-- Product Variants
INSERT INTO product_variants (id, product_id, sku, name, size, color, price_adjustment) VALUES
    -- 오버핏 코튼 티셔츠 variants
    ('c1000000-0000-0000-0000-000000000001', 'b1000000-0000-0000-0000-000000000001', 'MSS-CT-BK-S', '블랙 / S', 'S', '블랙', 0),
    ('c1000000-0000-0000-0000-000000000002', 'b1000000-0000-0000-0000-000000000001', 'MSS-CT-BK-M', '블랙 / M', 'M', '블랙', 0),
    ('c1000000-0000-0000-0000-000000000003', 'b1000000-0000-0000-0000-000000000001', 'MSS-CT-BK-L', '블랙 / L', 'L', '블랙', 0),
    ('c1000000-0000-0000-0000-000000000004', 'b1000000-0000-0000-0000-000000000001', 'MSS-CT-WH-M', '화이트 / M', 'M', '화이트', 0),
    ('c1000000-0000-0000-0000-000000000005', 'b1000000-0000-0000-0000-000000000001', 'MSS-CT-WH-L', '화이트 / L', 'L', '화이트', 0),
    -- 슬림핏 옥스포드 셔츠 variants
    ('c1000000-0000-0000-0000-000000000006', 'b1000000-0000-0000-0000-000000000002', 'PLO-OX-WH-M', '화이트 / M', 'M', '화이트', 0),
    ('c1000000-0000-0000-0000-000000000007', 'b1000000-0000-0000-0000-000000000002', 'PLO-OX-WH-L', '화이트 / L', 'L', '화이트', 0),
    ('c1000000-0000-0000-0000-000000000008', 'b1000000-0000-0000-0000-000000000002', 'PLO-OX-BL-M', '블루 / M', 'M', '블루', 0),
    -- 데님 팬츠 variants
    ('c1000000-0000-0000-0000-000000000009', 'b1000000-0000-0000-0000-000000000004', 'LV-DN-IN-30', '인디고 / 30', '30', '인디고', 0),
    ('c1000000-0000-0000-0000-000000000010', 'b1000000-0000-0000-0000-000000000004', 'LV-DN-IN-32', '인디고 / 32', '32', '인디고', 0),
    ('c1000000-0000-0000-0000-000000000011', 'b1000000-0000-0000-0000-000000000004', 'LV-DN-BK-32', '블랙 / 32', '32', '블랙', 0),
    -- 스마트폰 variants
    ('c1000000-0000-0000-0000-000000000012', 'b1000000-0000-0000-0000-000000000008', 'SS-S24U-256-TN', '티타늄그레이 / 256GB', '256GB', '티타늄그레이', 0),
    ('c1000000-0000-0000-0000-000000000013', 'b1000000-0000-0000-0000-000000000008', 'SS-S24U-512-TN', '티타늄그레이 / 512GB', '512GB', '티타늄그레이', 130000),
    ('c1000000-0000-0000-0000-000000000014', 'b1000000-0000-0000-0000-000000000009', 'AP-I15P-256-NT', '내추럴 / 256GB', '256GB', '내추럴', 0),
    ('c1000000-0000-0000-0000-000000000015', 'b1000000-0000-0000-0000-000000000009', 'AP-I15P-512-BK', '블랙 / 512GB', '512GB', '블랙', 150000),
    -- 노트북 variants
    ('c1000000-0000-0000-0000-000000000016', 'b1000000-0000-0000-0000-000000000010', 'AP-MBA-M3-8-256', 'M3 / 8GB / 256GB', '8GB/256GB', '스페이스그레이', 0),
    ('c1000000-0000-0000-0000-000000000017', 'b1000000-0000-0000-0000-000000000010', 'AP-MBA-M3-16-512', 'M3 / 16GB / 512GB', '16GB/512GB', '스페이스그레이', 300000),
    -- 에어팟 프로 variants
    ('c1000000-0000-0000-0000-000000000018', 'b1000000-0000-0000-0000-000000000012', 'AP-APP2-WH', '화이트', 'ONE', '화이트', 0),
    -- 신발 variants
    ('c1000000-0000-0000-0000-000000000019', 'b1000000-0000-0000-0000-000000000015', 'NK-AF1-WH-260', '화이트 / 260', '260', '화이트', 0),
    ('c1000000-0000-0000-0000-000000000020', 'b1000000-0000-0000-0000-000000000015', 'NK-AF1-WH-270', '화이트 / 270', '270', '화이트', 0),
    ('c1000000-0000-0000-0000-000000000021', 'b1000000-0000-0000-0000-000000000015', 'NK-AF1-WH-280', '화이트 / 280', '280', '화이트', 0);
